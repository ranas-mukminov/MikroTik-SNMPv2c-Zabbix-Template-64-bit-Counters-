<?xml version='1.0' encoding='UTF-8'?>
<zabbix_export version="7.0">
  <templates>
    <template>
      <uuid>3f2e39ca3b2c4dca808a16794d9037cd</uuid>
      <template>Template_Mikrotik_SNMPv2c_64bit</template>
      <name>Template Mikrotik SNMPv2c (64-bit)</name>
      <description>Enhanced SNMPv2c template for MikroTik routers with interface discovery, preprocessing and status monitoring tuned for Zabbix 7.0+.</description>
      <groups>
        <group>
          <name>Templates</name>
        </group>
      </groups>
      <items>
        <item>
          <uuid>2f66c20b1f864f9d8c20c0fd70bbdd26</uuid>
          <name>SNMP agent availability</name>
          <type>SNMP_AGENT</type>
          <snmp_oid>SNMPv2-MIB::sysUpTime.0</snmp_oid>
          <key>system.uptime[sysUpTime]</key>
          <delay>1m</delay>
          <history>7d</history>
          <trends>90d</trends>
          <status>ENABLED</status>
          <value_type>FLOAT</value_type>
          <units>s</units>
          <preprocessing>
            <step>
              <type>MULTIPLIER</type>
              <params>0.01</params>
            </step>
          </preprocessing>
          <tags>
            <tag>
              <tag>Application</tag>
              <value>System</value>
            </tag>
          </tags>
          <description>Device uptime in seconds (converted from SNMP timeticks).</description>
        </item>
        <item>
          <uuid>1660c6b9c63e4f77b13fb19f8d0db67a</uuid>
          <name>System description</name>
          <type>SNMP_AGENT</type>
          <snmp_oid>SNMPv2-MIB::sysDescr.0</snmp_oid>
          <key>system.descr[sysDescr]</key>
          <delay>1h</delay>
          <history>7d</history>
          <trends>0</trends>
          <status>ENABLED</status>
          <value_type>TEXT</value_type>
          <tags>
            <tag>
              <tag>Application</tag>
              <value>System</value>
            </tag>
          </tags>
          <description>Full system description to verify the SNMP agent identity.</description>
        </item>
      </items>
      <discovery_rules>
        <discovery_rule>
          <uuid>da4f31a5c93d4b26a07e38bc779ce611</uuid>
          <name>Network interface discovery</name>
          <type>SNMP_AGENT</type>
          <snmp_oid>discovery[{#IFINDEX},IF-MIB::ifIndex,{#IFDESCR},IF-MIB::ifDescr,{#IFNAME},IF-MIB::ifName,{#IFTYPE},IF-MIB::ifType,{#IFALIAS},IF-MIB::ifAlias,{#IFADMINSTATUS},IF-MIB::ifAdminStatus]</snmp_oid>
          <key>net.if.discovery</key>
          <delay>1h</delay>
          <status>ENABLED</status>
          <allowed_hosts/>
          <lifetime>7d</lifetime>
          <description>Discovers production interfaces, exposing name, alias, type and administrative state for refined filtering.</description>
          <filter>
            <formula>A&amp;B&amp;C</formula>
            <conditions>
              <condition>
                <macro>{#IFDESCR}</macro>
                <operator>MATCHES_REGEX</operator>
                <value>{$IF.LLD.FILTER.MATCH}</value>
                <formulaid>A</formulaid>
              </condition>
              <condition>
                <macro>{#IFDESCR}</macro>
                <operator>NOT_MATCHES_REGEX</operator>
                <value>{$IF.LLD.FILTER.NOT_MATCHES}</value>
                <formulaid>B</formulaid>
              </condition>
              <condition>
                <macro>{#IFADMINSTATUS}</macro>
                <operator>MATCHES_REGEX</operator>
                <value>{$IF.LLD.FILTER.ADMIN_STATUS}</value>
                <formulaid>C</formulaid>
              </condition>
            </conditions>
          </filter>
          <item_prototypes>
            <item_prototype>
              <uuid>5dd95fafbb7f43d89e48538a369627b4</uuid>
              <name>{#IFDESCR}: Inbound bandwidth</name>
              <type>SNMP_AGENT</type>
              <snmp_oid>IF-MIB::ifHCInOctets.{#IFINDEX}</snmp_oid>
              <key>net.if.in[{#IFINDEX}]</key>
              <delay>30s</delay>
              <history>7d</history>
              <trends>90d</trends>
              <status>ENABLED</status>
              <value_type>FLOAT</value_type>
              <units>bps</units>
              <preprocessing>
                <step>
                  <type>CHANGE_PER_SECOND</type>
                  <params/>
                </step>
                <step>
                  <type>MULTIPLIER</type>
                  <params>8</params>
                </step>
              </preprocessing>
              <tags>
                <tag>
                  <tag>Application</tag>
                  <value>Interfaces</value>
                </tag>
              </tags>
              <description>64-bit inbound traffic converted to bits per second.</description>
            </item_prototype>
            <item_prototype>
              <uuid>7b14829fa6de4b71ab488a297e0e86d8</uuid>
              <name>{#IFDESCR}: Outbound bandwidth</name>
              <type>SNMP_AGENT</type>
              <snmp_oid>IF-MIB::ifHCOutOctets.{#IFINDEX}</snmp_oid>
              <key>net.if.out[{#IFINDEX}]</key>
              <delay>30s</delay>
              <history>7d</history>
              <trends>90d</trends>
              <status>ENABLED</status>
              <value_type>FLOAT</value_type>
              <units>bps</units>
              <preprocessing>
                <step>
                  <type>CHANGE_PER_SECOND</type>
                  <params/>
                </step>
                <step>
                  <type>MULTIPLIER</type>
                  <params>8</params>
                </step>
              </preprocessing>
              <tags>
                <tag>
                  <tag>Application</tag>
                  <value>Interfaces</value>
                </tag>
              </tags>
              <description>64-bit outbound traffic converted to bits per second.</description>
            </item_prototype>
            <item_prototype>
              <uuid>5e3bb8b7eae44c7f8ff1fef8b6b7cfc0</uuid>
              <name>{#IFDESCR}: Operational status</name>
              <type>SNMP_AGENT</type>
              <snmp_oid>IF-MIB::ifOperStatus.{#IFINDEX}</snmp_oid>
              <key>net.if.status[{#IFINDEX}]</key>
              <delay>30s</delay>
              <history>30d</history>
              <trends>0</trends>
              <status>ENABLED</status>
              <value_type>UNSIGNED</value_type>
              <tags>
                <tag>
                  <tag>Application</tag>
                  <value>Interfaces</value>
                </tag>
              </tags>
              <description>Interface operational status (1=up, 2=down, 3=testing, 4=unknown, 5=dormant, 6=notPresent, 7=lowerLayerDown).</description>
            </item_prototype>
            <item_prototype>
              <uuid>9980217a1e8a4eb3844912275be917ce</uuid>
              <name>{#IFDESCR}: Inbound errors</name>
              <type>SNMP_AGENT</type>
              <snmp_oid>IF-MIB::ifInErrors.{#IFINDEX}</snmp_oid>
              <key>net.if.in.errors[{#IFINDEX}]</key>
              <delay>1m</delay>
              <history>7d</history>
              <trends>90d</trends>
              <status>ENABLED</status>
              <value_type>FLOAT</value_type>
              <preprocessing>
                <step>
                  <type>CHANGE_PER_SECOND</type>
                  <params/>
                </step>
              </preprocessing>
              <tags>
                <tag>
                  <tag>Application</tag>
                  <value>Interfaces</value>
                </tag>
              </tags>
              <description>Inbound error rate calculated per second.</description>
            </item_prototype>
            <item_prototype>
              <uuid>a2b82661dd0d4f098c113e5a7b7c2b3c</uuid>
              <name>{#IFDESCR}: Outbound errors</name>
              <type>SNMP_AGENT</type>
              <snmp_oid>IF-MIB::ifOutErrors.{#IFINDEX}</snmp_oid>
              <key>net.if.out.errors[{#IFINDEX}]</key>
              <delay>1m</delay>
              <history>7d</history>
              <trends>90d</trends>
              <status>ENABLED</status>
              <value_type>FLOAT</value_type>
              <preprocessing>
                <step>
                  <type>CHANGE_PER_SECOND</type>
                  <params/>
                </step>
              </preprocessing>
              <tags>
                <tag>
                  <tag>Application</tag>
                  <value>Interfaces</value>
                </tag>
              </tags>
              <description>Outbound error rate calculated per second.</description>
            </item_prototype>
            <item_prototype>
              <uuid>4e8f1c0f2d6248fb9c5a64b9a040a0ef</uuid>
              <name>{#IFDESCR}: Alias</name>
              <type>SNMP_AGENT</type>
              <snmp_oid>IF-MIB::ifAlias.{#IFINDEX}</snmp_oid>
              <key>net.if.alias[{#IFINDEX}]</key>
              <delay>1h</delay>
              <history>30d</history>
              <trends>0</trends>
              <status>ENABLED</status>
              <value_type>TEXT</value_type>
              <tags>
                <tag>
                  <tag>Application</tag>
                  <value>Interfaces</value>
                </tag>
              </tags>
              <description>Interface alias/description as configured on the MikroTik device.</description>
            </item_prototype>
            <item_prototype>
              <uuid>c7f53df78e84410a8ab8cf4aa6aa0280</uuid>
              <name>{#IFDESCR}: Configured speed</name>
              <type>SNMP_AGENT</type>
              <snmp_oid>IF-MIB::ifHighSpeed.{#IFINDEX}</snmp_oid>
              <key>net.if.highspeed[{#IFINDEX}]</key>
              <delay>5m</delay>
              <history>30d</history>
              <trends>90d</trends>
              <status>ENABLED</status>
              <value_type>FLOAT</value_type>
              <units>bps</units>
              <preprocessing>
                <step>
                  <type>MULTIPLIER</type>
                  <params>1000000</params>
                </step>
              </preprocessing>
              <tags>
                <tag>
                  <tag>Application</tag>
                  <value>Interfaces</value>
                </tag>
              </tags>
              <description>Configured interface bandwidth (converted from Mbps to bps) useful for capacity dashboards.</description>
            </item_prototype>
          </item_prototypes>
          <trigger_prototypes>
            <trigger_prototype>
              <uuid>9f05a950d24147b5845f9b5f0072ac6d</uuid>
              <expression>{Template_Mikrotik_SNMPv2c_64bit:net.if.status[{#IFINDEX}].last()}=2</expression>
              <name>{#IFDESCR}: Interface is down</name>
              <priority>AVERAGE</priority>
              <description>Alerts when an interface reports an operational status of down.</description>
              <tags>
                <tag>
                  <tag>Component</tag>
                  <value>Network</value>
                </tag>
              </tags>
            </trigger_prototype>
            <trigger_prototype>
              <uuid>6a7849d42c8b43df8a075fe9f82bc5a3</uuid>
              <expression>({Template_Mikrotik_SNMPv2c_64bit:net.if.in.errors[{#IFINDEX}].max(5m)}&gt;{$IF.ERRORS.MAX_DELTA}) or ({Template_Mikrotik_SNMPv2c_64bit:net.if.out.errors[{#IFINDEX}].max(5m)}&gt;{$IF.ERRORS.MAX_DELTA})</expression>
              <name>{#IFDESCR}: High error rate</name>
              <priority>WARNING</priority>
              <description>Warns when inbound or outbound error rates exceed the allowed per-second threshold.</description>
              <tags>
                <tag>
                  <tag>Component</tag>
                  <value>Network</value>
                </tag>
              </tags>
            </trigger_prototype>
          </trigger_prototypes>
        </discovery_rule>
      </discovery_rules>
      <httptests/>
      <macros>
        <macro>
          <macro>{$SNMP_COMMUNITY}</macro>
          <value>CHANGE_ME_SNMPV2C</value>
          <description>Default SNMP community string for SNMPv2c (override on hosts).</description>
        </macro>
        <macro>
          <macro>{$IF.LLD.FILTER.MATCH}</macro>
          <value>.*</value>
          <description>Regex of interfaces to keep during discovery (matches everything by default).</description>
        </macro>
        <macro>
          <macro>{$IF.LLD.FILTER.NOT_MATCHES}</macro>
          <value>(?i:loopback|virtual|vlan|gre|pppoe)</value>
          <description>Regex of interfaces to drop from discovery (loopbacks, virtual and tunnel links by default).</description>
        </macro>
        <macro>
          <macro>{$IF.LLD.FILTER.ADMIN_STATUS}</macro>
          <value>^1$</value>
          <description>Administrative states permitted for discovery (1 = up by default).</description>
        </macro>
        <macro>
          <macro>{$IF.ERRORS.MAX_DELTA}</macro>
          <value>1</value>
          <description>Maximum tolerated per-second error delta before raising the high error rate trigger.</description>
        </macro>
      </macros>
    </template>
  </templates>
</zabbix_export>
